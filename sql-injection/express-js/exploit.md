## SQL Injection

**SQL Injection (SQLi)** is a web security vulnerability that allows an attacker to interfere with the queries the server sends to the database.

An attacker can use this vulnerability to retrieve data from the database, this might include sensitive infromation like users' passwords or any other data that belongs to users. In many cases, an attacker can modify or delete this data, causing persistent changes to the application's content or behavior.

---

**Note:** You need to run the file **create-db.sql** in your terminal for the following to work, and do not forget to change the username and password for your mysql for all the files you will use.


An example of **SQLi** is providied in the **'/blind-injection'** folder, run the vulnerability.js file with the terminal using the command `node vulnerability.js`. Then search the url `http://localhost:3000/` in your browser, as you can see, this a login page.

Use Burp Suite Intruder or make a script yourself for automating requests to write the following in the username input to get the length of the password, increment the number (where the question mark is) by 1 until the server responds the a status 500:

`Admin'||(SELECT CASE WHEN LENGTH(password)=? THEN to_char(1/0) ELSE '' END FROM users WHERE username='Admin')||'`

Lets say the number you got is 20, the next step is to test the character at each position to determine its value. Change the value of the username to the following:

`Admin'||(SELECT CASE WHEN SUBSTR(password,?,?)='{ char }' THEN TO_CHAR(1/0) ELSE '' END FROM users WHERE username='Admin')||'`

replace the value where the first question mark is for each character in this string "abcdefghijklmnopqrstuvwxyQWERTYUIOPASDFGHJKLZXCVBNM0123456789" until it responds with a 500 status, note that character down then increment the value of the second question mark by 1 and so on until you get the full password.


Another example is in the folder **'/union-attack'**, run the vulnerability.js file with the terminal using the command `node vulnerability.js`. Then search the url `http://localhost:3000/` in your browser, this is a page for searching for other users.

Enter in the search field the following:

`Admin' UNION SELECT username, password From users WHERE '1'='1`

This will list all accounts stored in the database with their passwords.

---

**Solution:** You can prevent most instances of SQL injection using parameterized queries instead of string concatenation within the query, like the file **'/fix.js'**.